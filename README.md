# Minecraft Server Backend (работает только со стабильными версиями)
Это api предназначено для автоматического запуска и управления сервером Minecraft. На данный момент поддерживается работа только с одним сервером.
Для работы приложения требуется установленный Docker (версии 18.06.0 или выше) и Docker Compose (версии 1.27.0 или выше).

## Описание
Приложение позволяет:
* Автоматически скачивать и устанавливать необходимую версию Java для запуска сервера Minecraft.
* Управлять запуском серверов через HTTP-запросы.
* Настроить параметры сервера с помощью конфигурационного файла.
## Требования
Для работы приложения необходимо:
* Доступ к интернету для скачивания Java и серверных файлов.
* Docker (версии 18.06.0 или выше) и Docker Compose (версии 1.27.0 или выше).
## Установка
* Склонируйте репозиторий:
```
git clone https://github.com/your-repo/minecraft-backend.git
cd minecraft-backend
```
* Установите зависимости:
```
npm install
```
* По желанию: настройте конфигурационный файл config.json в папке проекта "config" или .env, находящийся в корке проекта (см. раздел "Конфигурация").
* Запустите приложение:
```
node index.js
```
## Конфигурация
Структура файла config.json:
```
{
  "serverDirectory": "./server",
  "javaPath": "./java/jdk/bin/java",
  "javaDownloads": {
    "linux": {
      "base": "https://api.adoptium.net/v3/binary/latest/{version}/ga/linux/x64/jdk/hotspot/normal/adoptium?project=jdk"
      }
    },
  "maxMemory": "2G",
  "minMemory": "1G",
  "defaultServerType": "vanilla",
  "defaultServerVersion": "1.20.6"
}
```
Параметры конфигурации:
* serverDirectory : Путь к папке, где будут храниться файлы сервера.
* javaPath : Путь к исполняемому файлу Java. Если Java еще не установлена, приложение автоматически скачает её.
* javaDownloads : Настройки для скачивания Java. Включает базовый URL для Linux.
* maxMemory : Максимальный объем оперативной памяти, выделяемый серверу (например, 2G).
* minMemory : Минимальный объем оперативной памяти, выделяемый серверу (например, 1G).
* defaultServerType : Параметр стандартного типа сервера, если параметр не передан в запросе запуска (vanilla для стандартного сервера Minecraft).
* defaultServerVersion : Параметр стандартной версии сервера, если параметр не передан в запросе запуска (1.20.6 для стандартного сервера Minecraft).

Стуктура файла .env:
```
API_PASSWORD=your_secure_password_here
```
Файл .env используется для настройки пароля доступа к API. Аутентификация выполняется посредством передачи параметра Authorization в заголовке.
Пример запроса:
```
curl -H "Authorization: your_secure_password_here" http://192.168.20.184:3001/start?type=vanilla&version=1.10.1
```
## Запуск сервера
Для запуска сервера отправьте HTTP-запрос на следующий URL:
```
http://192.168.20.184:3001/start?type=vanilla&version=1.20.1
```
Параметры запроса:
type : Тип сервера (например, vanilla для стандартного сервера Minecraft). P.S. Тип можно оставить пустым, будет выбрана версия vanilla.
version : Версия сервера Minecraft (например, 1.20.1). P.S. Версию можно не указывать, будет выбрана версия 1.20.6
### Пример использования
#### Запуск сервера
Пример запроса:
```
curl "http://192.168.20.184:3001/start?type=vanilla&version=1.20.1"
```
Приложение выполнит следующие шаги:
* Проверит наличие необходимой версии Java.
* Скачает и установит Java, если она отсутствует (при первом запуске контейнера всегда происходит скачивание Java).
* Скачает JAR-файл сервера Minecraft указанной версии.
* Запустит сервер с указанными параметрами памяти.
#### Остановка сервера
Пример запроса:
```
curl "http://192.168.20.184:3001/stop"
```
Приложение выполнит следующие шаги:
* На сервере выполнится команда остановки сервера, мир будет сохранён, а сервер выключен (бекенд при это не выключается).

#### Рестарт сервера
Пример запроса:
```
curl "http://192.168.20.184:3001/start?type=vanilla&version=1.20.1"
```
Приложение выполнит следующие шаги:
* Выполнится шаг "Остановка сервера".
* Выполнится шаг "Запуск сервера" (сейчас обязательно передавать параметры при рестарте, в будущем поправлю).

#### Сохранение мира
Пример запроса:
```
curl "http://192.168.20.184:3001/start?type=vanilla&version=1.20.1"
```
Приложение выполнит следующие шаги:
* На сервере выполнится команда "save-all", которая сохранит мир

#### Получение информации о сервере
Пример запроса:
```
curl "http://192.168.20.184:3001/status
```
Приложение выполнит следующие шаги:
* Выполнится функция getMemoryUsage ()

# Дальнейшие планы
* Расширить поддержку типов серверов (например, Paper, Forge, Fabric).
* Добавить API для управления сервером (добавить маршрут для прямого ввода команд, а также добавить систему мониторинга) (в процессе).
* Улучшить и изменить структуру файла конфига, для более расширенной система запуска сервера.
* Улучшить систему логирования (отключение и включение разной степени логов)

# История версий:
- 0.1: Добавление api для работы сервера
- 0.2: Добавлена возможность автоматического скачивания java и сервера выбранной версии
- 1.0: Переделана структура проекта, а также добавлена сборка через Docker. Добавлена двех новых команды: restart (просто вызывается stop и start) и save (выполняет запрос на сохранение мира)
- 1.1: Удалена папка "Java", в которой хранились версии Java (теперь при пересборке контейнер и запуске сервера, всегда выполняется первое скачивание Java)
- 1.2: Добавлена аутентификация к основным маршрутам (если присутствует .env файл и в нём указан пароль)
- 1.2a: Модифицирована логика выбора версии Java
- 1.3: Добавлен новый маршрут для оправления команд на сервер через тело (body) запроса (Нужно поправить количество игроков на сервере, чтобы бралось актуальное кол-во)
- 1.4: Добавление Forge версии для запуска